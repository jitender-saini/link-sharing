<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register User</title>
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/customize.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>

</head>
<body>
<div class="container">
    <div class="row vertical-offset-100">
        <div class="col-md-4 col-md-offset-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row-fluid user-row">
                        <img src="images/logo.png" class="img-responsive" alt="Link Sharing">
                    </div>
                </div>
                <div class="panel-body regForm">
                    <form accept-charset="UTF-8"  id="registerForm" method="POST" enctype="multipart/form-data">
                        <fieldset>
                            <div class="form-element-container"><input id="firstName" name="firstName" placeholder="First Name" type="text" class="input-txt form-control"/></div>
                            <div class="form-element-container"><input id="lastName" name="lastName" placeholder="Last Name" type="text" class="input-txt form-control"/></div>
                            <div class="form-element-container"><input id="email" name="email" placeholder="Email Address" type="text" class="input-txt form-control"/></div>
                            <div class="form-element-container"><input id="userName" name="userName" placeholder="User Name" type="text" class="input-txt form-control"/></div>
                            <div class="form-element-container"><input id="password" name="password" placeholder="Password" type="password" class="input-txt form-control"/></div>
                            <div class="form-element-container"><input id="password-confirm" name="passwordConfirm" placeholder="Re-enter password" type="password" class="input-txt form-control" disabled="disabled" /></div>

                            <label for="userImage"><small>Upload Profile Picture</small></label>
                            <div class="form-element-container"><input type="file"  id="userImage" value="" /> </div>


                            <input type="submit" id="createAccount" class="create-acc btn btn--right btn-lg btn-success btn-block" value="Create My Account"/>
                        </fieldset>
                    </form><br/>
                    <label>Already have and account? <a href="login.html">Login here</a></label>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    var nameIsErroneous = true, passwordIsErroneous = true, passwordMatchIsErroneous = true, userNameIsErroneous = true, emailIsErroneous = true;

    /*when page loads all the fields are loaded with blank values ... removes any chances of GUI error*/
    $(document).ready(function(){
        $("#firstName").val("");
        $("#lastName").val("");
        $("#email").val("");
        $("#userName").val("");
    });

    /*Single function to be called to show error message*/
    function showError(id, message, errorId){
        if($("#"+id).parent().find("#"+errorId).length >0 &&
            $("#"+id).parent().find("#"+errorId).text().trim() == message
        ) return;
        if($("#"+id).parent().find("#"+errorId).text().trim() != message) hideError(errorId);
        var errorHtml = '<div class="errorRegistration" id="'+errorId+'">'+message+'</div>';
        $("#"+id).parent().append(errorHtml).hide(0);
        $("#"+errorId).hide(0);
        $("#"+id).parent().show(0);
        $("#"+errorId).show(600);
    }
    /*Single function to be called to hide error message*/
    function hideError(errorId){
        $("#"+errorId).hide(500,function(){
            $("#"+errorId).remove()});
    }

    /*Validation to to check that user enters only english alphabets including space*/
    function alphabetsOnly(eleId){
        var  errorMessage="Enter english literals for Name.", errorId = "alphabetError";
        var text = $("#"+eleId).val();
        nameIsErroneous = false;
        if (text.trim()!="")
        {
            var ch, i;
            for(i=0; i<text.length; i++)
            {
                ch = text.charCodeAt(i);
                if((ch <65 || (ch>90 && ch<97) || ch>122)&& ch!=32)
                {
                    ch = text.charAt(i);
                    showError(eleId,errorMessage,errorId);
                    nameIsErroneous = true;
                    break;
                }
            }
            if(nameIsErroneous ==false)
                hideError(errorId);
        }
        else
        {
            nameIsErroneous = true;
            errorMessage = "User name can't be empty";
            showError(eleId,errorMessage,errorId);
        }
    }
    /*Validate the password*/
    function checkPassword(eleId,passLength){
        var  errorMessage="Password length should be at least "+passLength, errorId = "passwordError";
        var pass = $("#"+eleId).val();
        passwordIsErroneous = false;
        if(pass.length != pass.trim().length) {
            passwordIsErroneous=true;
            $("#password-confirm").attr("disabled","disabled");
            errorMessage = "Password can't start or end with space";
            showError(eleId,errorMessage,errorId);
        }
        else if(pass.length<passLength) {
            passwordIsErroneous=true;
            $("#password-confirm").attr("disabled","disabled");
            showError(eleId,errorMessage,errorId);
        }
        else {
            passwordIsErroneous =false;
            $("#password-confirm").removeAttr("disabled");
            hideError(errorId);
        }
    }

/*    validate userName */
    function checkUserName(eleId,uNameLength) {
        console.log(uNameLength)
        var  errorMessage="UserName length should be at least "+uNameLength, errorId = "userNameError";
        var uName = $("#"+eleId).val();
        userNameIsErroneous = false;
        if(uName.length != uName.trim().length){
            userNameIsErroneous = true;
            errorMessage = "UserName can't start or end with space";
            showError(eleId,errorMessage,errorId);
        }
        else if (uName.length<uNameLength){
            userNameIsErroneous = true;
            showError(eleId,errorMessage,errorId);
        }
        else {
            userNameIsErroneous = false;
            hideError(errorId);
        }
    }

    /*Matches both the passwords*/
    function confirmPassword(eleId,compareWith){
        var  errorMessage="Password doesn't match", errorId = "confirmPasswordError";
        passwordMatchIsErroneous = false;
        if($("#"+eleId).val() != $("#"+compareWith).val()) {
            passwordMatchIsErroneous=true;
            showError(eleId,errorMessage,errorId);
        }
        else {
            hideError(errorId);
            passwordMatchIsErroneous = false;
        }
    }
    /*Validate proper email address*/
    function checkEMail(eleId){
        emailIsErroneous = false;
        var  errorMessage="Enter correct email address", errorId = "emailRegExError";
        var email = $("#"+eleId).val();
        var emailRegEx = /^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|in|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i;
        if(!emailRegEx.test(email)) {
            emailIsErroneous = true;
            showError(eleId,errorMessage,errorId);
        }
        else {
            emailIsErroneous = false;
            hideError(errorId);
        }
    }

    /*Trigger functions to validate on different events*/
    $("#firstName").on("focusout",function(){
        var id = ($(this).attr('id'));
        alphabetsOnly(id);
    });

    $("#lastName").on("focusout",function(){
        var id = ($(this).attr('id'));
        alphabetsOnly(id);
    });

    $("#email").on("focusout",function(){
        var id = ($(this).attr('id'));
        checkEMail(id);
    })

    $("#userName").on("focusout keyup",function () {
        var id = ($(this).attr('id'));
        var userNameLength= 5;
        checkUserName(id,userNameLength);

    })

    $("#password").on("focusout keyup",function(){
        var passLength = 6;
        var id = ($(this).attr('id'));
        checkPassword(id,passLength);
    })

    $("#password-confirm").on("focusout",function(event){
        event.stopPropagation();
        var compareWith = "password";
        var id = ($(this).attr('id'));
        confirmPassword(id,compareWith);
    })

    /*On submit button click it re-checks all the fields to validate form*/
    $("#registerForm").submit(function(e){
        e.preventDefault();
        if(!nameIsErroneous && !passwordIsErroneous && !passwordMatchIsErroneous && !userNameIsErroneous && !emailIsErroneous) {
            $(this).unbind("submit").submit();
        }
        if(nameIsErroneous) {
            $("#firstName").trigger("focusout");
        }
        if(nameIsErroneous) {
            $("#lastName").trigger("focusout");
        }
        if(passwordIsErroneous) {
            $("#password").trigger("focusout");
        }
        if(passwordMatchIsErroneous) {
            $("#password-confirm").trigger("focusout");
        }
        if(emailIsErroneous) {
            $("#email").trigger("focusout");
        }
        if(userNameIsErroneous) {
            $("#userName").trigger("focusout");
        }
    })
</script>
</body>
</html>